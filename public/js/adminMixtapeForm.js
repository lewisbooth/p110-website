"use strict";var form=document.querySelector(".dashboard__edit-article"),titleInput=form.querySelector('input[name="title"]'),artistsInput=form.querySelector('input[name="artists"]'),descriptionInput=form.querySelector('textarea[name="description"]'),releaseDateInput=form.querySelector('input[name="releaseDate"]'),publishedInput=form.querySelector('input[name="published"]'),zipInput=form.querySelector('input[name="zip"]'),artworkInput=form.querySelector('input[name="coverImage"]'),artworkImage=form.querySelector(".dashboard__edit-mixtape--artwork"),progressBar=form.querySelector("progress"),progressBarText=form.querySelector(".progress-bar__percent-completed"),progressBarContainer=form.querySelector(".progress-bar"),defaultArtwork=artworkImage.src,formErrors=document.querySelector(".form-errors"),lightbox=document.querySelector(".lightbox"),deleteButton=document.querySelector("#dashboard__edit-video--delete"),closeLightboxButton=document.querySelector(".lightbox__modal--cancel"),trackListings=document.querySelector(".mixtapes__track-listing"),addTrackButton=document.querySelector(".mixtapes__track-listing--add-track"),isEditPage=window.location.toString().indexOf("/edit/")>0;function submitForm(t){t.preventDefault(),updateTrackListingStateFromDOM();var e=new FormData;e.append("title",titleInput.value),e.append("artists",artistsInput.value),e.append("description",descriptionInput.value),e.append("published",publishedInput.checked),e.append("releaseDate",releaseDateInput.value),e.append("trackListing",JSON.stringify(trackListingState)),zipInput.files&&zipInput.files[0]&&e.append("zip",zipInput.files[0]),artworkInput.files&&artworkInput.files[0]&&e.append("artwork",artworkInput.files[0]);var r={onUploadProgress:function(t){var e=Math.floor(100*t.loaded/t.total);progressBar.value=e,progressBarText.innerText=e+"%"}};(zipInput.files[0]||artworkInput.files[0])&&progressBarContainer.classList.remove("hidden"),axios.post(window.location.href,e,r).then(function(t){window.location="/admin/mixtapes"}).catch(function(t){console.log(t),errorFlash([t.response.data.error])})}function errorFlash(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];formErrors.innerHTML="",0!==t.length&&"undefined"!==t[0]||(t=["An error occurred, please try again"]),t.forEach(function(t){void 0===t&&(t="An error occured");var e=document.createElement("p");e.innerText=t,formErrors.appendChild(e)})}isEditPage&&(deleteButton.addEventListener("click",function(){return lightbox.classList.toggle("active")}),closeLightboxButton.addEventListener("click",function(){return lightbox.classList.toggle("active")})),form.addEventListener("submit",function(t){submitForm(t)}),artworkInput.addEventListener("change",function(t){if(artworkInput.files&&artworkInput.files[0]){var e=new FileReader;e.onload=function(t){artworkImage.src=t.target.result,artworkImage.classList.remove("hidden")},e.readAsDataURL(artworkInput.files[0])}else artworkImage.src=defaultArtwork});var trackListingState=[];function setState(t){t!=trackListingState&&(trackListingState=t,renderState())}function renderState(){var t="";trackListingState.forEach(function(e,r){t+=generateListingMarkup(e,r)}),trackListings.innerHTML=t,getTrackListingEntries().forEach(function(t,e){t.querySelector(".mixtapes__track-listing--entry--delete").addEventListener("click",function(t){t.target.parentElement.remove(),updateTrackListingStateFromDOM()})})}var generateListingMarkup=function(t,e){return'\n  <div class="mixtapes__track-listing--entry" draggable="true" ondragstart="dragTrack(event)" ondrop="dropTrack(event)" ondragover="allowDrop(event)" data-key="'+e+'">\n    <div class="mixtapes__track-listing--entry--number">\n      '+e+'\n    </div>\n    <input value="'+t.title+'" type="text" class="mixtapes__track-listing--entry--title">\n    <input value="'+t.duration+'" type="text" class="mixtapes__track-listing--entry--duration">\n    <div class="mixtapes__track-listing--entry--delete">\n      âœ•\n    </div>\n  </div>\n'},getTrackListingData=function(t){var e=t.querySelector(".mixtapes__track-listing--entry--title").value,r=t.querySelector(".mixtapes__track-listing--entry--duration").value,a=new RegExp(/([0-9]{1,2}:[0-9]{2})/);return r.match(a)||(r="0:00"),{title:e,duration:r}},getTrackListingEntries=function(){return trackListings.querySelectorAll(".mixtapes__track-listing--entry")};function updateTrackListingStateFromDOM(){var t=[];getTrackListingEntries().forEach(function(e,r){var a=getTrackListingData(e),n=a.title,i=a.duration;t.push({title:n,duration:i})}),setState(t)}function dragTrack(t){t.dataTransfer.setData("start",t.target.getAttribute("data-key"))}function dropTrack(t){t.preventDefault();var e=t.dataTransfer.getData("start"),r=void 0;r=t.target.classList.contains("mixtapes__track-listing--entry")?t.target.getAttribute("data-key"):t.target.parentElement.getAttribute("data-key"),console.log(e,r)}function allowDrop(t){t.preventDefault()}updateTrackListingStateFromDOM(),addTrackButton.addEventListener("click",function(){updateTrackListingStateFromDOM(),trackListingState.push({title:"",duration:"0:00"}),renderState()});