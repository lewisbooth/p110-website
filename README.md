# P110.co.uk Website
A full-stack NodeJS MVC application with custom CMS and Youtube API integration. 

Designed to sit behind an Nginx proxy which handles SSL and static files.

![P110 Website](https://s3.eu-west-2.amazonaws.com/p110/p110-media-website.jpg)

## Tech overview

#### Express
The core web server, route handler and backbone of the application.

#### MongoDB
Stores accounts and simple CMS data for news articles, video posts and artists. Simple relational queries are used to attach artists to posts.

#### Passport
Handles login sessions and secure password hashing.

#### Stylus
CSS preprocessor of choice, used with PostCSS for browser prefixing and minifying. Critical above-the-fold CSS is separated and inlined for faster page rendering.

#### Pug
HTML templating language of choice for rendering views and emails.

#### Gulp
Handles CSS and JS preprocessing. Uses a BrowserSync proxy to inject CSS changes, sync across devices and reload pages automatically.

#### Youtube Scraper
Custom-built on top of the Youtube API to track pageviews across all videos on a regular basis. Used to generate lists of top videos, aggregate scores across artists and show view counts.

#### Automatic backups
The database is backed up to S3 every night, limited the most recent 30 backups. Backup limits and frequency are configurable.

#### Sitemap
The sitemap is generated by crawling the site when the server loads and is refreshed nightly (configurable) via cron. The XML file is placed into the public folder to be served statically.


## Getting Started

#### Environment variables
Create a file called variables.env in the root folder and fill it with the correct information (see variables.example.env). Make sure to use a secure session key and secret.

Use `development` or `production` in NODE_ENV to switch modes. Production mode is much faster and caches Pug templates in memory, but isn't suitable for front-end development because the server must be restarted to load changes.

#### Starting the server
Run `npm install` to install the dependencies.

You'll need two terminal sessions, tmux with two panes is my preferred option.

Run `npm start` in the first session to start the Express server and `gulp` in the second session to start Gulp/BrowserSync.